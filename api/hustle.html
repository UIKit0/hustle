<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>hustle – Hustle Distributed OLAP Database &mdash; Hustle 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Hustle 0.1 documentation" href="../index.html" />
    <link rel="next" title="hustle.core.marble – The Hustle Database Core" href="core.html" />
    <link rel="prev" title="Hustle Indexes" href="../howto/index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="core.html" title="hustle.core.marble – The Hustle Database Core"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../howto/index.html" title="Hustle Indexes"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Hustle 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="module-hustle"></span><div class="section" id="hustle-hustle-distributed-olap-database">
<h1><a class="reference internal" href="#module-hustle" title="hustle"><tt class="xref py py-mod docutils literal"><span class="pre">hustle</span></tt></a> &#8211; Hustle Distributed OLAP Database<a class="headerlink" href="#hustle-hustle-distributed-olap-database" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="#module-hustle" title="hustle"><tt class="xref py py-mod docutils literal"><span class="pre">hustle</span></tt></a> module contains everything a client application will
typically need to create hustle <a class="reference internal" href="#hustle.Table" title="hustle.Table"><tt class="xref py py-class docutils literal"><span class="pre">Tables</span></tt></a> and to insert and query
data to/from them.</p>
<p>Hustle <a class="reference internal" href="#hustle.Table" title="hustle.Table"><tt class="xref py py-class docutils literal"><span class="pre">Tables</span></tt></a> are stored in multiple, <a class="reference external" href="http://symas.com/mdb/">LMDB</a> memory
mapped files, which are replicated into <a class="reference external" href="http://discoproject.org">Disco&#8217;s</a> Distributed File System (<em>DDFS</em>).
Queries are run using a <a class="reference internal" href="../howto/query.html#queryguide"><em>Python DSL</em></a> which is translated dynamically into a Disco
<em>pipelined map/reduce</em>  job.</p>
<p>Hustle is ideal for low latency OLAP queries over massive data sets.</p>
<dl class="class">
<dt id="hustle.Table">
<em class="property">class </em><tt class="descclassname">hustle.</tt><tt class="descname">Table</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#hustle.Table" title="Permalink to this definition">¶</a></dt>
<dd><p>The fundamental data type to support Hustle&#8217;s relational model.  A Table contains a number of named
<tt class="xref py py-class docutils literal"><span class="pre">Columns</span></tt>, each of which is decorated with schema information.
Note that the table is stored in Disco&#8217;s
<a class="reference external" href="http://disco.readthedocs.org/en/latest/lib/ddfs.html">DDFS</a> distributed file system as a series of replicated
sub-database files encapsulated by <a class="reference external" href="http://symas.com/mdb/">LMDB</a> memory mapped b+ tree files called
<a class="reference internal" href="core.html#hustle.core.marble.Marble" title="hustle.core.marble.Marble"><tt class="xref py py-class docutils literal"><span class="pre">Marbles</span></tt></a>.  Each <em>Marble</em> contains the data for the rows and columns
of the Table.</p>
<p>Normally, a table is created using <a class="reference internal" href="#hustle.Table.create" title="hustle.Table.create"><tt class="xref py py-meth docutils literal"><span class="pre">hustle.Table.create()</span></tt></a>, which creates the appropriately named DDFS tag and
attributes.  To instantiate an existing Table (to use in a query, for example), the <a class="reference internal" href="#hustle.Table.from_tag" title="hustle.Table.from_tag"><tt class="xref py py-meth docutils literal"><span class="pre">hustle.Table.from_tag()</span></tt></a>
method is used.</p>
<p>see <a class="reference internal" href="../howto/schema.html#schemadesign"><em>Hustle Schema Design Guide</em></a> for a detailed look at Hustle&#8217;s schema design language and features.</p>
<dl class="classmethod">
<dt id="hustle.Table.from_tag">
<em class="property">classmethod </em><tt class="descname">from_tag</tt><big>(</big><em>name</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#hustle.Table.from_tag" title="Permalink to this definition">¶</a></dt>
<dd><p>Instantiate a named <a class="reference internal" href="#hustle.Table" title="hustle.Table"><tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt></a> based on meta data from a <em>DDFS</em> tag.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> (<a class="reference external" href="http://docs.python.org/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; the name of the table</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="hustle.Table.create">
<em class="property">classmethod </em><tt class="descname">create</tt><big>(</big><em>name</em>, <em>fields=()</em>, <em>partition=None</em>, <em>force=False</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#hustle.Table.create" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new <a class="reference internal" href="#hustle.Table" title="hustle.Table"><tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt></a>, replace existing table if force=True.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="http://docs.python.org/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; the name of the table to create</li>
<li><strong>fields</strong> (<em>sequence of string</em>) &#8211; the list of <em>columns</em> and their encoded index/type information (see <a class="reference internal" href="../howto/schema.html#schemadesign"><em>Hustle Schema Design Guide</em></a>)</li>
<li><strong>partition</strong> (<a class="reference external" href="http://docs.python.org/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; the name of the column to act as the partition for this table</li>
<li><strong>force</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) &#8211; overwrite the existing DDFS base tag with this schema</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This function will not delete or update existing data in any way.  If you use force=True to change
the schema, make sure you either make the change backward compatible (by only adding new columns), or
by deleting and reloading your data.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">For a good example of creating a partitioned Hustle database see
<a class="reference internal" href="../howto/integration_tests.html#integrationtests"><em>Hustle Integration Tests</em></a></p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="hustle.Table.base_tag">
<em class="property">classmethod </em><tt class="descname">base_tag</tt><big>(</big><em>name</em>, <em>partition=None</em><big>)</big><a class="headerlink" href="#hustle.Table.base_tag" title="Permalink to this definition">¶</a></dt>
<dd><p>return the <em>DDFS</em> tag name for a given hustle table name</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="http://docs.python.org/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; the name of the table</li>
<li><strong>partition</strong> (<a class="reference external" href="http://docs.python.org/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; the value of the partition</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="hustle.insert">
<tt class="descclassname">hustle.</tt><tt class="descname">insert</tt><big>(</big><em>table</em>, <em>phile=None</em>, <em>streams=None</em>, <em>preprocess=None</em>, <em>maxsize=104857600</em>, <em>tmpdir='/tmp'</em>, <em>decoder=None</em>, <em>lru_size=10000</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#hustle.insert" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert data into a Hustle <a class="reference internal" href="#hustle.Table" title="hustle.Table"><tt class="xref py py-class docutils literal"><span class="pre">hustle.Table</span></tt></a>.</p>
<p>Create a  <a class="reference internal" href="core.html#hustle.core.marble.Marble" title="hustle.core.marble.Marble"><tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Marble</span></tt></a> file given the input file or streams according to the schema of the
table.  Push this (these) file(s) into <em>DDFS</em> under the appropriated (possibly) partitioned <em>DDFS</em> tags.</p>
<p>Note that a call to <a class="reference internal" href="#hustle.insert" title="hustle.insert"><tt class="xref py py-func docutils literal"><span class="pre">hustle.insert()</span></tt></a> may actually create and push more than one file, depending on how
many partition values exist in the input.  Be careful.</p>
<p>For a good example of inserting into a partitioned Hustle database see <tt class="xref py py-mod docutils literal"><span class="pre">hustle.integration_test.setup</span></tt> and
<a class="reference internal" href="../howto/insert.html#insertguide"><em>Inserting Data To Hustle</em></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>table</strong> (<a class="reference internal" href="#hustle.Table" title="hustle.Table"><tt class="xref py py-class docutils literal"><span class="pre">hustle.Table</span></tt></a>) &#8211; the table to perform the insert on</li>
<li><strong>phile</strong> (<a class="reference external" href="http://docs.python.org/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; the file path to open</li>
<li><strong>streams</strong> (<em>sequence of iterable</em>) &#8211; as an alternative to the <em>phile</em> argument, you can specify a list of generators as input</li>
<li><strong>preprocess</strong> (<em>function</em>) &#8211; <p>a function that accepts and returns a dict()</p>
<p>The input is transformed into a <a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a> by the <em>decoder</em> param, then the <em>preprocess</em> function is
called for every record.  This gives you the opportunity to transform, filter or otherwise clean your
data before it is inserted into the <a class="reference internal" href="core.html#hustle.core.marble.Marble" title="hustle.core.marble.Marble"><tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Marble</span></tt></a></p>
</li>
<li><strong>maxsize</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) &#8211; <p>the initial size in bytes of the <em>LMDB</em> memory mapped file</p>
<p>Note that the actual underlying LMDB file will grow as data is added to it - this setting is just for it&#8217;s
initial size.</p>
</li>
<li><strong>tmpdir</strong> (<a class="reference external" href="http://docs.python.org/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; <p>the temporary directory to write the LMDB memory mapped file</p>
<p>Note that choosing a directory on an SSD drive will nicely increase throughput.</p>
</li>
<li><strong>decoder</strong> (<em>function</em>) &#8211; <p>accepts a line of raw input from the input and returns a <a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a></p>
<p>The dict is expected to have keys that correspond to the column names in the table you are inserting to.  There
are two built-in decoders in Hustle: <tt class="xref py py-func docutils literal"><span class="pre">hustle.core.marble.json_decoder()</span></tt> (default) and
<tt class="xref py py-func docutils literal"><span class="pre">hustle.core.marble.kv_decoder()</span></tt> for processing JSON and Disco <em>chain</em> input files, respectively.</p>
</li>
<li><strong>lru_size</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) &#8211; <p>the size in records of the LRU cache for holding bitmapped indexes</p>
<p>You probably won&#8217;t have to worry about this unless you find your insert is running out of memory or is too
slow when inserting gigantic files or on nodes with limited memory resources.  see <a class="reference internal" href="../howto/index.html#indexguide"><em>Hustle Indexes</em></a></p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="hustle.select">
<tt class="descclassname">hustle.</tt><tt class="descname">select</tt><big>(</big><em>*project</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#hustle.select" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a relational query, by selecting rows and columns from one or more tables.</p>
<p>The return value is either:
* a list of urls containing the result records.  This is the same as normal results from Disco
* a <a class="reference internal" href="#hustle.Table" title="hustle.Table"><tt class="xref py py-class docutils literal"><span class="pre">hustle.Table</span></tt></a> instance when <em>nest</em> == True</p>
<p>For all of the examples below, <em>imps</em> and <em>pix</em> are instances of <a class="reference internal" href="#hustle.Table" title="hustle.Table"><tt class="xref py py-class docutils literal"><span class="pre">hustle.Table</span></tt></a>.</p>
<p>Arguments:
:type project: list of <tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Column</span></tt> | <tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Aggregation</span></tt>
:param project: a positional argument list of columns and aggregate expressions to return in the result</p>
<blockquote>
<div><p># simple projection
select(imps.ad_id, imps.date, imps.cpm_millis, where=imps)</p>
<p>Selects three columns from the <em>imps</em> table.</p>
<p>Hustle also allows for <em>aggregation functions</em> such as <a class="reference internal" href="#hustle.h_sum" title="hustle.h_sum"><tt class="xref py py-func docutils literal"><span class="pre">hustle.h_sum()</span></tt></a>, <a class="reference internal" href="#hustle.h_count" title="hustle.h_count"><tt class="xref py py-func docutils literal"><span class="pre">hustle.h_count()</span></tt></a>,
<a class="reference internal" href="#hustle.h_min" title="hustle.h_min"><tt class="xref py py-func docutils literal"><span class="pre">hustle.h_min()</span></tt></a>, <a class="reference internal" href="#hustle.h_max" title="hustle.h_max"><tt class="xref py py-func docutils literal"><span class="pre">hustle.h_max()</span></tt></a>, <a class="reference internal" href="#hustle.h_avg" title="hustle.h_avg"><tt class="xref py py-func docutils literal"><span class="pre">h_avg()</span></tt></a> as in this example which sums the imps.cpm_millis
column:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">select</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">ad_id</span><span class="p">,</span> <span class="n">h_sum</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">cpm_millis</span><span class="p">),</span> <span class="n">h_count</span><span class="p">(),</span> <span class="n">where</span><span class="o">=</span><span class="n">imps</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="s">&#39;2014-01-27&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that Hustle doesn&#8217;t have a <em>group by</em> clause.  In this query, the output will be <em>grouped</em> by the
imps.ad_id column implicitly.  Note that in Hustle, if there is an aggregation function present in the
<em>project</em> param, the query results will be <em>grouped</em> by all non-aggregation present.</p>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>where</strong> ((optional) sequence of <a class="reference internal" href="#hustle.Table" title="hustle.Table"><tt class="xref py py-class docutils literal"><span class="pre">hustle.Table</span></tt></a> | <tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Expr</span></tt>) &#8211; <p>the Tables to fetch data from, as well as the conditions in the <em>where clause</em></p>
<p>This two purposes: to specify the tables that are to be queried and to allow for the
selection of data under specific criteria with our Python DSL selection syntax, much the like SQL&#8217;s <em>where
clause</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># simple projection with restriction</span>
<span class="n">select</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">ad_id</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">cpm_millis</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">imps</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="s">&#39;2014-01-27&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the <em>==</em> operation between the imps.date column and the date string.  The <tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Column</span></tt>
class overrides all of Python&#8217;s comparison operators, which, along with the <em>&amp;</em>, <em>|</em> and <em>~</em> logical
operators allows you to build arbitrarily complex column selection expressions like this:</p>
<div class="highlight-python"><div class="highlight"><pre>select(imps.ad_id, imps.date, imps.cpm_millis,
        where=((imps.date &gt;= &#39;2014-01-21&#39;) &amp; (imps.date &lt;= &#39;2014-01-23&#39;)) |
              ~(imps.site_id == &#39;google.com))
</pre></div>
</div>
<p>Note that for these expressions, the column must come first.  This means that the following expression is
<strong>illegal</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">select</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">ad_id</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">cpm_millis</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s">&#39;2014-01-27&#39;</span> <span class="o">==</span> <span class="n">imps</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
</pre></div>
</div>
<p>In addition, multiple tables can be specified in the where clause like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">select</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">ad_id</span><span class="p">,</span> <span class="n">pix</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;</span> <span class="s">&#39;2014-01-13&#39;</span><span class="p">,</span> <span class="n">pix</span><span class="p">))</span>
</pre></div>
</div>
<p>which specifies an expression (imps.date &lt; &#8216;2014-01-13&#8217;) and a <a class="reference internal" href="#hustle.Table" title="hustle.Table"><tt class="xref py py-class docutils literal"><span class="pre">hustle.Table</span></tt></a> tuple.  This query
will simply return all of the <em>ad_id</em> values in <em>imps</em> for dates less than January 13th followed by all of the
<em>amound</em> values in the <em>pix</em> table.</p>
<p>Using multiple columns is typically reserved for when you use a <em>join clause</em></p>
</li>
<li><strong>join</strong> (sequence of exactly length 2 of <tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Column</span></tt>) &#8211; <p>specified the columns to perform a relational join operation on for the query</p>
<p>Here&#8217;s an example of a Hustle join:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">select</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">ad_id</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">site_id</span><span class="p">,</span> <span class="n">h_sum</span><span class="p">(</span><span class="n">pix</span><span class="o">.</span><span class="n">amount</span><span class="p">),</span> <span class="n">h_count</span><span class="p">(),</span>
       <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;</span> <span class="s">&#39;2014-01-13&#39;</span><span class="p">,</span> <span class="n">pix</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;</span> <span class="s">&#39;2014-01-13&#39;</span><span class="p">),</span>
       <span class="n">join</span><span class="o">=</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">site_id</span><span class="p">,</span> <span class="n">pix</span><span class="o">.</span><span class="n">site_id</span><span class="p">))</span>
</pre></div>
</div>
<p>which joins the <em>imps</em> and <em>pix</em> tables on their common <em>site_id</em> column, then returns the sum of the
<em>pix.amount</em> columns and a count, grouped by the <em>ad_id</em> and the <em>site_id</em>.  The equivalent query in SQL
is:</p>
<div class="highlight-python"><div class="highlight"><pre>select i.ad_id, i.site_id, sum(p.amount), count(*)
from imps i
join pix p on p.site_id = p.site_id
where i.date &lt; &#39;2014-01-13&#39; and i.date &lt; &#39;2014-01-13&#39;
group by i.ad_id, i.site_id
</pre></div>
</div>
</li>
<li><strong>order_by</strong> (string | <tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Column</span></tt> | (sequence of string | <tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Column</span></tt>)) &#8211; <p>the column(s) to sort the result by</p>
<p>The sort columns can be specified either as a Column or a list of Columns.  Alternatively, you can specify
a column by using a string with either the name of the column or the <em>table.column</em> string notation.  Here
are a few examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">select</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">ad_id</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">cpm_millis</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">imps</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="n">imps</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
<span class="n">select</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">ad_id</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">cpm_millis</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">imps</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">ad_id</span><span class="p">))</span>
<span class="n">select</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">ad_id</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">cpm_millis</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">imps</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="s">&#39;date&#39;</span><span class="p">)</span>
<span class="n">select</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">ad_id</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">cpm_millis</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">imps</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="s">&#39;imps.date&#39;</span><span class="p">)</span>
<span class="n">select</span><span class="p">(</span><span class="n">imps</span><span class="o">.</span><span class="n">ad_id</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">cpm_millis</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">imps</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;date&#39;</span><span class="p">,</span> <span class="n">imps</span><span class="o">.</span><span class="n">ad_id</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><strong>desc</strong> (<em>boolean</em>) &#8211; affects sort order of the <em>order_by clause</em> to descending (default ascending)</li>
<li><strong>distinct</strong> (<em>boolean</em>) &#8211; indicates whether to remove duplicates in results</li>
<li><strong>limit</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) &#8211; limits the total number of records in the output</li>
<li><strong>nest</strong> (<em>boolean (default = False)</em>) &#8211; <p>specify that the return value is a <a class="reference internal" href="#hustle.Table" title="hustle.Table"><tt class="xref py py-class docutils literal"><span class="pre">hustle.Table</span></tt></a> to be used in another query</p>
<p>This allows us to build nested queries.  You may want to do this to join more than two tables, or to reuse
the results of a query in more than one subsequent query.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre>``active_pix = select(*star(pix), where=pix.isActive &gt; 0, nest=True)``
select(h_sum(active_pix.amount), where=active_pix)
</pre></div>
</div>
</li>
<li><strong>kwargs</strong> (<a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; custom settings for this query see <tt class="xref py py-mod docutils literal"><span class="pre">hustle.core.settings</span></tt></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="hustle.h_sum">
<tt class="descclassname">hustle.</tt><tt class="descname">h_sum</tt><big>(</big><em>col</em><big>)</big><a class="headerlink" href="#hustle.h_sum" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an aggregation for the sum of the given column.  Like SQL sum() function.
This is used in <a class="reference internal" href="#hustle.select" title="hustle.select"><tt class="xref py py-func docutils literal"><span class="pre">hustle.select()</span></tt></a> calls to specify the sum aggregation over a column in a query:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">select</span><span class="p">(</span><span class="n">h_sum</span><span class="p">(</span><span class="n">employee</span><span class="o">.</span><span class="n">salary</span><span class="p">),</span> <span class="n">employee</span><span class="o">.</span><span class="n">department</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">employee</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
<p>returns the total salaries for each departments employees over 25 years old</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>col</strong> (<tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Column</span></tt>) &#8211; the column to aggregate</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="hustle.h_count">
<tt class="descclassname">hustle.</tt><tt class="descname">h_count</tt><big>(</big><big>)</big><a class="headerlink" href="#hustle.h_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an aggregation for the count of each grouped key in a query.  Like SQL count() function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">select</span><span class="p">(</span><span class="n">h_count</span><span class="p">(),</span> <span class="n">employee</span><span class="o">.</span><span class="n">department</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">employee</span><span class="p">)</span>
</pre></div>
</div>
<p>returns a count of the number of employees in each department.</p>
</dd></dl>

<dl class="function">
<dt id="hustle.h_max">
<tt class="descclassname">hustle.</tt><tt class="descname">h_max</tt><big>(</big><em>col</em><big>)</big><a class="headerlink" href="#hustle.h_max" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an aggregation for the maximum of the given column.  Like the SQL max() function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">select</span><span class="p">(</span><span class="n">h_max</span><span class="p">(</span><span class="n">employee</span><span class="o">.</span><span class="n">salary</span><span class="p">),</span> <span class="n">employee</span><span class="o">.</span><span class="n">department</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">employee</span><span class="p">)</span>
</pre></div>
</div>
<p>returns the highest salary for each department.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>col</strong> (<tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Column</span></tt>) &#8211; the column to aggregate</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="hustle.h_min">
<tt class="descclassname">hustle.</tt><tt class="descname">h_min</tt><big>(</big><em>col</em><big>)</big><a class="headerlink" href="#hustle.h_min" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an aggregation for the minimum of the given column.  Like the SQL min() function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">select</span><span class="p">(</span><span class="n">h_min</span><span class="p">(</span><span class="n">employee</span><span class="o">.</span><span class="n">salar</span><span class="p">),</span> <span class="n">employee</span><span class="o">.</span><span class="n">department</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">employee</span><span class="p">)</span>
</pre></div>
</div>
<p>returns the lowest salary in each department.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>col</strong> (<tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Column</span></tt>) &#8211; the column to aggregate</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="hustle.h_avg">
<tt class="descclassname">hustle.</tt><tt class="descname">h_avg</tt><big>(</big><em>col</em><big>)</big><a class="headerlink" href="#hustle.h_avg" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an aggregation for the average of the given column.  Like the SQL avg() function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">select</span><span class="p">(</span><span class="n">h_avg</span><span class="p">(</span><span class="n">employee</span><span class="o">.</span><span class="n">salary</span><span class="p">),</span> <span class="n">employee</span><span class="o">.</span><span class="n">department</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">employee</span><span class="p">)</span>
</pre></div>
</div>
<p>returns the average salary in each department</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>col</strong> (<tt class="xref py py-class docutils literal"><span class="pre">hustle.core.marble.Column</span></tt>) &#8211; the column to aggregate</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="hustle.star">
<tt class="descclassname">hustle.</tt><tt class="descname">star</tt><big>(</big><em>table</em><big>)</big><a class="headerlink" href="#hustle.star" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the list of all columns in a table.  This is used much like the <tt class="docutils literal"><span class="pre">*</span></tt> notation in SQL:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sb">``</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="n">star</span><span class="p">(</span><span class="n">employee</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="n">employee</span><span class="o">.</span><span class="n">department</span> <span class="o">==</span> <span class="s">&#39;Finance&#39;</span><span class="p">)</span><span class="sb">``</span>
</pre></div>
</div>
<p>returns all of the columns from the <em>employee</em> table for the Finance department.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>col</strong> &#8211; the table to extract the column names from</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="hustle.dump">
<tt class="descclassname">hustle.</tt><tt class="descname">dump</tt><big>(</big><em>result_urls</em>, <em>width=80</em><big>)</big><a class="headerlink" href="#hustle.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump the results of a query.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>result_urls</strong> (<em>sequence of strings</em>) &#8211; result of an (unnested) query</li>
<li><strong>width</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) &#8211; the number of columns to constrain output to</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="hustle.get_tables">
<tt class="descclassname">hustle.</tt><tt class="descname">get_tables</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#hustle.get_tables" title="Permalink to this definition">¶</a></dt>
<dd><p>return the visible Hustle tables in the currently configured DDFS server.  Hustle finds tables by looking
for DDFS tags that have a <em>hustle:</em> prefix.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>kwargs</strong> (<a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; custom settings for this query see <tt class="xref py py-mod docutils literal"><span class="pre">hustle.core.settings</span></tt></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="hustle.tables">
<tt class="descclassname">hustle.</tt><tt class="descname">tables</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#hustle.tables" title="Permalink to this definition">¶</a></dt>
<dd><p>Print all available tables.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>kwargs</strong> (<a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; custom settings for this query see <tt class="xref py py-mod docutils literal"><span class="pre">hustle.core.settings</span></tt></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="hustle.schema">
<tt class="descclassname">hustle.</tt><tt class="descname">schema</tt><big>(</big><em>tab</em>, <em>index_only=False</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#hustle.schema" title="Permalink to this definition">¶</a></dt>
<dd><p>Print the schema for a given table</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>kwargs</strong> (<a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; custom settings for this query see <tt class="xref py py-mod docutils literal"><span class="pre">hustle.core.settings</span></tt></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="hustle.partitions">
<tt class="descclassname">hustle.</tt><tt class="descname">partitions</tt><big>(</big><em>table</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#hustle.partitions" title="Permalink to this definition">¶</a></dt>
<dd><p>Print the partitions for a given table.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>kwargs</strong> (<a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; custom settings for this query see <tt class="xref py py-mod docutils literal"><span class="pre">hustle.core.settings</span></tt></td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="../howto/index.html"
                        title="previous chapter">Hustle Indexes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="core.html"
                        title="next chapter"><tt class="docutils literal"><span class="pre">hustle.core.marble</span></tt> &#8211; The Hustle Database Core</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/api/hustle.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="core.html" title="hustle.core.marble – The Hustle Database Core"
             >next</a> |</li>
        <li class="right" >
          <a href="../howto/index.html" title="Hustle Indexes"
             >previous</a> |</li>
        <li><a href="../index.html">Hustle 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Tim Spurway.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>